# Multi-view Multi-person SMPLify3D

- [Multi-view Multi-person SMPLify3D](#multi-view-multi-person-smplify3d)
  - [Overview](#overview)
  - [Argument](#argument)
  - [Example](#example)

## Overview

This tool could generate multi-view multi-person SMPLData from keypoints3d.

## Argument

- **estimator_config**:
`estimator_config` is the path to a `MultiPersonSMPLEstimator` config file. For more details, see docs for `MultiPersonSMPLEstimator` and the docstring in [code](../../../xrmocap/core/estimation/mperson_smpl_estimator.py).

- **start_frame**:
`start_frame` is the index of the start frame.

- **end_frame**:
`end_frame` is the index of the end frame.

- **bbox_thr**:
`bbox_thr` is the threshold of the 2d bbox, which should be the same as the threshold used to generate the keypoints3d.

- **keypoints3d_path**:
`keypoints3d_path` is the path to the keypoints3d file.

- **matched_kps2d_idx**:
`matched_kps2d_idx` is the matched keypoints2d index from different views, where is generated by [code](../../../tools/mview_mperson_evaluation.py).

- **image_and_camera_param**:
`image_and_camera_param` is a text file contains the image path and the corresponding camera parameters. Line 0 is the image path of the first view, and line 1 is the corresponding camera parameter path. Line 2 is the image path of the second view, and line 3 is the corresponding camera parameter path, and so on.

- **perception2d_path**:
`perception2d_path` is the path to the 2d perception data.

- **output_dir**:
`output_dir` is the path to the directory saving all possible output files, including SMPLData and visualization videos.

- **visualize**:
By default, visualize is False. Add `--visualize` makes it True and the tool will visualize SMPLData with an orbit camera, overlay SMPL meshes on one view.

- **enable_log_file**
By default, enable_log_file is False and the tool will only print log to console. Add `--enable_log_file` makes it True and a log file named `{smc_file_name}_{time_str}.txt` will be written.


## Example

Run the tool with visualization.

```python
python tools/mview_mperson_smplify3d.py \
      --estimator_config 'configs/modules/core/estimation/mperson_smpl_estimator.py' \
      --start_frame 300 \
      --end_frame 600 \
      --keypoints3d_path 'output/mvpose_tracking/shelf/scene0_pred_keypoints3d.npz' \
      --matched_kps2d_idx 'output/mvpose_tracking/shelf/scene0_matched_kps2d_idx.npy' \
      --image_and_camera_param 'xrmocap_data/Shelf/image_and_camera_param.txt' \
      --perception2d_path 'xrmocap_data/Shelf/xrmocap_meta_test/scene_0/perception_2d.npz' \
      --output_dir 'output/mvpose_tracking/shelf/smpl' \
      --visualize \
      --enable_log_file
```
