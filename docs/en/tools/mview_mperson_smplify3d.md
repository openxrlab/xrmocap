# Multi-view Multi-person SMPLify3D

- [Overview](#overview)
- [Argument](#argument)
- [Example](#example)

## Overview

This tool could generate multi-view multi-person SMPLData from keypoints3d.

## Argument

- **estimator_config**:
`estimator_config` is the path to a `MultiViewMultiPersonSMPLEstimator` config file. For more details, see docs for `MultiViewMultiPersonSMPLEstimator` and the docstring in [code](../../../xrmocap/core/estimation/mview_mperson_smpl_estimator.py).

- **image_dir**:
`image_dir` is the path to the directory containing RGB sequence. If you have five views of the RGB sequences, there should be five folders in `image_dir`.

- **start_frame**:
`start_frame` is the index of the start frame.

- **end_frame**:
`end_frame` is the index of the end frame.

- **bbox_thr**:
`bbox_thr` is the threshold of the 2d bbox, which should be the same as the threshold used to generate the keypoints3d.

- **keypoints3d_path**:
`keypoints3d_path` is the path to the keypoints3d file.

- **matched_kps2d_idx**:
`matched_kps2d_idx` is the matched keypoints2d index from different views, where is generated by [code](../../../tools/mview_mperson_evaluation.py).

- **fisheye_param_dir**:
`fisheye_param_dir` is the path to the directory containing camera parameter.

- **perception2d_path**:
`perception2d_path` is the path to the 2d perception data.

- **output_dir**:
`output_dir` is the path to the directory saving all possible output files, including SMPLData and visualization videos.

- **visualize**:
By default, visualize is False. Add `--visualize` makes it True and the tool will visualize SMPLData with an orbit camera, overlay SMPL meshes on one view.

- **enable_log_file**
By default, enable_log_file is False and the tool will only print log to console. Add `--enable_log_file` makes it True and a log file named `{smc_file_name}_{time_str}.txt` will be written.


## Example

Run the tool with visualization.

```bash
python tools/mview_mperson_smplify3d.py \
      --estimator_config 'configs/modules/core/estimation/mview_mperson_smpl_estimator.py' \
      --image_dir 'xrmocap_data/Shelf' \
      --start_frame 300 \
      --end_frame 600 \
      --keypoints3d_path 'output/mvpose_tracking/shelf/scene0_pred_keypoints3d.npz' \
      --matched_kps2d_idx 'output/mvpose_tracking/shelf/scene0_matched_kps2d_idx.npy' \
      --fisheye_param_dir 'xrmocap_data/Shelf/xrmocap_meta_test/scene_0/camera_parameters' \
      --perception2d_path 'xrmocap_data/Shelf/xrmocap_meta_test/scene_0/perception_2d.npz' \
      --output_dir 'output/mvpose_tracking/shelf/smpl' \
      --visualize \
      --enable_log_file
```
